# Device ID Attack Exploit

#### You:
Can you write me a text for my report that only uses the information in the pdf pages that I uploaded.
Please only use the information provided on the pdf pages and call something always consistently in the same way. Please create me some latex code that I can directly paste into my document. The use of itemize or some similar environment is wanted if it fits. Please replace unicode symbols by fitting latex math symbols.
The text should mention the most important basic details about the attack like:
- the attack has to work indirectly over 2 phases, because the code executed in the browser from a website has only limieted access. The attacking device is basically a black box with TCP-Syn packets as output which allow to read out the source ports.
- we have here a similar problem like in a particle accelerator, one cannot directly see the collisions of loopback 3-tuples in the perturbation table out of which one generates the the device id like one can also not directly see the particles that are colliding in a particle accelerator. But one can see the effects of those collisions as the source port for a attacker 3-tuple changes in a predicatable way if a loopback 3-tuple collides with it in the the same perturbation table cell. One can read those source ports out from TCP-Syn Packets. 
- the attack abuses hash collisions to construct a device id from patterns of these hash colisions by collecting enoguh of these hash collisions. 
- Include the followign line from one of the pdfs: GK2(IPSRC = 127.0.0.1,IPDST = 127.1.2.3,PORTDST = x) = GK2(IPSRC = 127.0.0.1,IPDST = 127.1.2.3,PORTDST = y) and explain it. 
- Explain how exactly the device id looks like using the followign line from the pfds:  {(xi,yi)} and this line from the pdfs:  (x1,x2),...,(x1,xk) and say what x1, x2  etc. are
- the device id can be construct accross networks and is only not able to persist restarts, because the key gets generated on startup of linux and are used for everything from there on
- these hash colisions can only be made visiable by reading those source ports from the Syn packets and analyse how those change in a predictable way as the DHPS algorithm is predictable at the following line of the code: tableindex ←tableindex +1 because it increments a table entry in a 
predictable way which is used by the attack algorithm.
- the diffent roles of the attack 3-tuples and the loopback 3-tuples and which are actually used for the device id

#### ChatGPT:
Excellent! Based strictly on the information from your uploaded PDFs, here’s LaTeX code you can directly paste into your document. It captures all the details you asked for, using consistent terms and matching the terminology and notation from the papers:

```latex
\section{Device Tracking via TCP Source Port Collisions}

The attack described in the paper works in two phases, because code executed in the browser from a website has only limited access. Essentially, the attacking device is a black box whose observable output consists of TCP SYN packets, from which the attacker reads the source ports~\cite{device_tracking-1,device_tracking-2,device_tracking-4}.

\subsection{Core Idea and Analogy}

The attack exploits hash collisions in Linux’s Double-Hash Port Selection (DHPS) algorithm to build a device identifier. This situation is similar to a particle accelerator: just as one cannot directly observe the collisions of particles, one cannot directly observe the collisions of loopback 3-tuples in the perturbation table out of which the device ID is derived. However, the effects of such collisions can be seen because the source port for an attacker 3-tuple changes in a predictable way if a loopback 3-tuple collides with it in the same perturbation table cell. These source ports are observable via TCP SYN packets~\cite{device_tracking-4}.

\subsection{Two Phases of the Attack}

The attack consists of the following two phases~\cite{device_tracking-5}:

\begin{itemize}
    \item \textbf{Phase 1:} The attacker identifies $T$ \emph{attacker 3-tuples}, each mapping to a unique cell in the perturbation table. This mapping is detected via specific port increments. The browser sends three bursts of TCP SYN packets to various external destinations, and the attacker checks which destination IP-port combinations cause the source port to increment by exactly $1$. These form the attacker 3-tuples.

    \item \textbf{Phase 2:} The attacker tests \emph{loopback 3-tuples} (where both source and destination IPs are loopback addresses) to see which perturbation table cell they map to. If two loopback 3-tuples hash to the same perturbation table cell, this creates a collision visible as a specific increment in the source port observed when the attacker “sandwiches” connections to the loopback 3-tuple between bursts of connections to the attacker 3-tuples.
\end{itemize}

The predictability comes from the DHPS algorithm incrementing the table index deterministically, as shown in the code line:

\begin{verbatim}
tableindex ← tableindex + 1
\end{verbatim}

which advances the state in the perturbation table in a predictable way used by the attack algorithm~\cite{device_tracking-5}.

\subsection{Exploiting Hash Collisions}

The attack exploits collisions in the following sense:

\begin{equation*}
\mathrm{GK2}(\mathrm{IPSRC} = 127.0.0.1,\; \mathrm{IPDST} = 127.1.2.3,\; \mathrm{PORTDST} = x) \;=\; \mathrm{GK2}(\mathrm{IPSRC} = 127.0.0.1,\; \mathrm{IPDST} = 127.1.2.3,\; \mathrm{PORTDST} = y)
\end{equation*}

This means that two different loopback 3-tuples, differing only in destination port numbers $x$ and $y$, hash to the same cell in the perturbation table under the function $\mathrm{GK2}$. These collisions depend solely on the kernel’s secret key $K_2$ generated at system startup. Hence, they form the basis of a device ID~\cite{device_tracking-4}.

\subsection{Device ID Construction}

The device ID consists of the set of all such colliding pairs:

$
\left\{ (x_i, y_i) \right\}
$

where each pair $(x_i, y_i)$ represents two destination ports for which the corresponding loopback 3-tuples collide under the same perturbation table cell. More concretely, if there are $k$ loopback 3-tuples falling into the same cell, only $k-1$ pairs are used, specifically:

$
(x_1, x_2),\; \ldots,\; (x_1, x_k)
$

where $x_1, x_2, \ldots, x_k$ are destination ports used in loopback 3-tuples. This pairing avoids over-counting collisions. The set of these pairs uniquely represents the device as long as the secret key $K_2$ remains the same~\cite{device_tracking-5}.

\subsection{Persistence and Scope of the Device ID}

The device ID can be constructed across different networks and persists through network changes, browser restarts, and even different browsers or containers running on the same machine. However, it cannot survive device restarts because $K_2$ is regenerated upon each system startup~\cite{device_tracking-4}.

\subsection{Roles of 3-Tuples}

The attack distinguishes between two types of 3-tuples~\cite{device_tracking-4}:

\begin{itemize}
    \item \textbf{Attacker 3-tuples:} These consist of:
    \begin{equation*}
    (\mathrm{IPSRC}_{\text{Internet-facing}}, \mathrm{IPDST}_{\text{tracking server}}, \mathrm{PORTDST})
    \end{equation*}
    They are used to cover the perturbation table and help detect changes in source ports.

    \item \textbf{Loopback 3-tuples:} These consist of:
    \begin{equation*}
    (\mathrm{IPSRC} = 127.0.0.1, \mathrm{IPDST} = 127.1.2.3, \mathrm{PORTDST})
    \end{equation*}
    They are used to find collisions within the perturbation table and directly form the device ID. Only loopback 3-tuples contribute to the device ID, while attacker 3-tuples merely serve as probes to reveal perturbation table behavior.
\end{itemize}

The attack exploits the predictability of the port increment pattern to reveal these collisions and thus construct a stable, cross-network device ID~\cite{device_tracking-4,device_tracking-5}.

```

Let me know if you’d like this condensed, further formatted, or tailored for a particular document class (e.g., `IEEEtran`, `acmart`, etc.)!


#### You:
Can you write me a another text for my report that only uses the information in the pdf pages that I uploaded.
Please only use the information provided on the pdf pages and call something always consistently in the same way. Please create me some latex code that I can directly paste into my document. The use of itemize or some similar environment is wanted if it fits. Please replace unicode symbols by fitting latex math symbols.
The text should mention the most important basic details about phase of the attack like:
- because of limited access one cannot directly see loopback 3-tuple colisions with each other, one cannot see the source port the DHPS allgorithm calculates for them. One can only determine which loopback 3- tuples collide with each other indirectly via the attacker 3-tuples one calculated in phase 1 that cover all cells of the perturbations table. The attacker 3 are able to make colisions of looback 3-tuples visible, because one can observe how the source ports generated by the dhps algorithm that one can observe via TCP-Syn packets change in a prediable way by increment of the perturbation table cell entry if they there's a collision of attacker 3-tuple and loopback 3 -tuple in the same perturbation table cell.
- what the steps of the phase 2 algorithm are
- that phase 2 uses a sandwiching method to find out which loopback 3-tuples collide with what other loopback 3-tuple to build a device id, the new loopback 3 -tuples is send several times inside the sandwich and attacker 3-tuples that cover all petrurbation table cells and that  are there to make those colisions visisble are oustide in the sandwich
- mention how one know with which are loopback 3-tuples  a single loopback 3-tuples collides if it collides with any  
- one does only send one loopback 3-tuple inside the sandwich but several times, because there's no way to determine with which otherr loopback 3-tuples a lopback 3 -tuples collided, because one only sees the diffrece in the source-ports of the attacker 3-tuples outside of thesandwich, but not which loopback 3 -tuples caused it. But if one only sends the same loopback 3 -tuple several times, one knows which loopback 3 -tuples one let the code of the website send in which order and can thus determine that loopback 3- tuples collilde if they colide with the same attacker 3-tuple, i.e. lead to a difference in the sandwich construction.
- in the paper it's not said why the same loopback 3 tuples is send several times, give a possible reason for that or maybe find if there's really no reason for that given the paper. I'm not sure about that

#### ChatGPT:
Excellent! Based strictly on the information from your uploaded PDFs, here’s LaTeX code you can paste into your document, describing **Phase 2** as you requested. I’ve used consistent terminology (e.g. “attacker 3-tuple,” “loopback 3-tuple,” etc.) from the papers and included possible interpretation about sending the same loopback 3-tuple multiple times, based on what the papers say (or don’t say).

```latex
\section{Details of Phase 2 of the Attack}

Because code running in the browser has limited access, one cannot directly observe collisions among loopback 3-tuples. Specifically, it is not possible to see the source port values that the Double-Hash Port Selection (DHPS) algorithm calculates for connections between loopback 3-tuples~\cite{device_tracking-5,device_tracking-7}. Instead, collisions among loopback 3-tuples must be detected indirectly, using the attacker 3-tuples determined in Phase 1, which cover all cells of the perturbation table. These attacker 3-tuples make collisions among loopback 3-tuples visible, because an attacker can observe how the source ports generated by the DHPS algorithm change in a predictable way—through increments in the perturbation table cell entry—if a loopback 3-tuple and an attacker 3-tuple fall into the same cell~\cite{device_tracking-5}.

\subsection{Steps of the Phase 2 Algorithm}

Phase 2 proceeds as follows~\cite{device_tracking-5}:

\begin{itemize}
    \item The attacker iterates over a list $L$ of loopback 3-tuples.
    \item In each iteration:
    \begin{itemize}
        \item A burst of TCP SYN packets is sent to all $T$ attacker 3-tuples identified in Phase 1.
        \item Several TCP SYN packets are sent to one specific loopback 3-tuple $L_i$.
        \item Another burst of TCP SYN packets is sent to all $T$ attacker 3-tuples.
        \item The tracking server checks which attacker 3-tuple’s observed source port has advanced by more than $1$. This indicates that $L_i$ and the attacker 3-tuple share the same perturbation table cell.
        \item If a collision is found, the pair $(L_i, B_w)$ is stored, where $B_w$ is the first loopback 3-tuple found for this cell.
    \end{itemize}
    \item This is repeated until a sufficient number of independent collisions have been collected to build a device ID with the desired uniqueness probability.
\end{itemize}

\subsection{Sandwiching Method}

Phase 2 uses a \emph{sandwiching} method to detect collisions between loopback 3-tuples~\cite{device_tracking-5,device_tracking-7}. The procedure is as follows:

\begin{itemize}
    \item A single loopback 3-tuple is sent multiple times in the middle of two bursts of connections to the attacker 3-tuples that cover all perturbation table cells.
    \item These attacker 3-tuples “surrounding” the loopback connections serve as probes. By observing changes in their source port values after the sandwich, one can deduce if the loopback 3-tuple shares a cell with any attacker 3-tuple.
\end{itemize}

\subsection{Detecting Collisions}

The attacker can determine which attacker 3-tuple shares a cell with the loopback 3-tuple $L_i$ if the observed source port for that attacker 3-tuple has increased by more than $1$ after the sandwich. However, one does not know directly with which other loopback 3-tuples $L_i$ collides, if any~\cite{device_tracking-5}. Instead, the collisions are inferred indirectly:

\begin{itemize}
    \item Only one loopback 3-tuple is sent in the sandwich at a time, but it is sent multiple times.
    \item This avoids ambiguity because, if multiple different loopback 3-tuples were sent in the sandwich, it would be impossible to know which one caused the observed increment in the source port of the attacker 3-tuples.
    \item By sending only the same loopback 3-tuple several times, the attacker knows precisely which 3-tuple was responsible for any detected collision.
    \item If two loopback 3-tuples eventually map to the same attacker 3-tuple (same perturbation table cell), they are considered colliding.
\end{itemize}

\subsection{Reason for Sending the Same Loopback 3-Tuple Several Times}

The papers describe that the same loopback 3-tuple is sent multiple times inside the sandwich, but they do not explicitly state the reason. However, based on the attack description, a plausible reason is:

\begin{itemize}
    \item Sending the same loopback 3-tuple multiple times ensures that any increment in the shared counter of the perturbation table cell is large enough to be reliably detected by the attacker. For example, in Figure 2 of~\cite{device_tracking-7}, the source port advanced by 4, reflecting multiple SYN packets sent to the same loopback 3-tuple.
    \item Additionally, sending it several times increases confidence that the increment observed is indeed caused by that specific loopback 3-tuple and not random noise or unrelated connections.
\end{itemize}

Thus, while the papers do not explicitly state the purpose, sending the same loopback 3-tuple multiple times appears to serve both signal amplification and clarity of attribution.

\subsection{Outcome of Phase 2}

By repeatedly applying this sandwiching technique, the attacker collects pairs of colliding loopback 3-tuples. These pairs ultimately form the device ID, unique to the secret key $K_2$ used by the DHPS algorithm~\cite{device_tracking-5}. The process terminates once enough independent collisions are found to achieve a desired confidence level in device uniqueness.

```

Let me know if you’d like this more concise, more detailed, or tailored to a specific LaTeX document style!


#### You:
Can you write me a text for my report that only uses the information in the pdf pages that I uploaded.
Please only use the information provided on the pdf pages and call something always consistently in the same way. Please create me some latex code that I can directly paste into my document. The use of itemize or some similar environment is wanted if it fits.
The text should explain phase 1 of the attack and it's output and input and should mention things like:
- that phase 1 uses a sandwiching method to find  a attack 3-tuple for every table cell of the perturbatioon table, the new attack 3-tuple candidtates are outside and the attack 3-tuples that uniequely coverr all cells of the pertubation table are inside
- tell how the first round of this sanwiching method looks like if there are no known attacker 3-tuples iside the sanwich. In thise case there can still be increases larger than 1, if the attackeer 3-tuplle candidates collide with each other, they will not be added to the set of attacker 3-tuples that cover the cells of the perrtrurbation table that are used inside the sandwich 
- mention how one know that the attack 3-tuple candidate does map to a pertubation table cell that has no attack 3-tuple assigned so far
- one can't directly find out to which index of the perturbation table a attack 3-table is exactly mapped, one does only know that a certain attacker 3-tuple is the first to map to a cell by seeing no collisions to any of the attacker 3-tuples that cover the pertrurbaton table cells that get visible by increases larrger 1 of the same attacker 3-tuple
- one can find the corresponding attacker 3-tuple to a source port out, because one has a mapping of attacker 3-tuples to their sourceports, because one determined those from the TCP-Syn packets where one sees which sourceport is generated from them
- phase 1 ends as soon as there's a attack 3-tuple for every cell of the perturbation table 
- the text should mention that having these attack 3-tuples for every cell of the perturbation table is important for phase 2 because one cannot determine colisions of loopback 3-tuples between each other, because the attacked device only allows limited access. One has to deterrminen loopback 3 tuple colilsions by the fact the these loopback 3-tuples collide with same attacker 3-tuple.

#### ChatGPT:
Fantastic. Here’s LaTeX code you can directly paste into your document. It explains Phase 1 based only on the information in your PDFs, uses consistent terminology (e.g. “attacker 3-tuple”), and fits the style and level of detail you specified.

```latex
\section{Details of Phase 1 of the Attack}

Phase 1 of the attack aims to identify a set of attacker 3-tuples such that each one maps uniquely to a different cell of the perturbation table used by the Double-Hash Port Selection (DHPS) algorithm in the Linux kernel~\cite{device_tracking-5,device_tracking-6}. This set of attacker 3-tuples is essential for Phase 2, because collisions between loopback 3-tuples cannot be directly observed. Instead, these collisions must be inferred by detecting whether different loopback 3-tuples collide with the \emph{same} attacker 3-tuple~\cite{device_tracking-5}.

\subsection{Sandwiching Method}

Phase 1 uses a \emph{sandwiching method} consisting of three bursts of TCP SYN packets~\cite{device_tracking-5,device_tracking-6}:

\begin{itemize}
    \item \textbf{First Burst:} Sent to a set $S_i$ of new attacker 3-tuple candidates.
    \item \textbf{Second Burst:} Sent to all attacker 3-tuples currently known to uniquely cover perturbation table cells (the set $S'_{i-1}$).
    \item \textbf{Third Burst:} Sent again to the same set $S_i$ of new attacker 3-tuple candidates.
\end{itemize}

Thus, the \emph{new attacker 3-tuple candidates are outside the sandwich}, and the \emph{known attacker 3-tuples that cover cells of the perturbation table are inside the sandwich}~\cite{device_tracking-5}.

\subsection{First Round Without Known Attacker 3-Tuples}

In the very first round of Phase 1, there are no known attacker 3-tuples to place inside the sandwich. Therefore, the second burst of the sandwich is effectively empty. Nevertheless, collisions can still be detected in this round because some attacker 3-tuple candidates in $S_i$ may collide with each other. If the source port difference for an attacker 3-tuple candidate between the first and third bursts is greater than $1$, this indicates that it shares a perturbation table cell with another candidate in $S_i$ and thus cannot be added to the set of unique attacker 3-tuples~\cite{device_tracking-5,device_tracking-6}.

\subsection{Detecting Unique Mapping}

An attacker 3-tuple candidate $x \in S_i$ is determined to map to a previously uncovered perturbation table cell if the following condition holds:

$
P'(x) - P(x) = 1
$

where $P(x)$ and $P'(x)$ denote the source ports assigned to $x$ in the first and third bursts, respectively. If this difference is exactly $1$, it means no collision occurred with any previously known attacker 3-tuple or with other candidates in $S_i$, and thus $x$ is the first 3-tuple to map to that perturbation table cell~\cite{device_tracking-5}.

\subsection{Mapping Source Ports to Attacker 3-Tuples}

Although it is impossible to directly determine to which specific index in the perturbation table an attacker 3-tuple is mapped, it is still possible to identify that a certain attacker 3-tuple is the \emph{first} to map to a cell, as no collisions were observed in the sandwich construction for that tuple. The attacker can relate observed source ports to attacker 3-tuples because the tracking server maintains a mapping:

$
(\mathrm{IPSRC}, \mathrm{IPDST}, \mathrm{PORTDST}) \;\rightarrow\; \mathrm{PORTSRC}
$

obtained from analyzing the TCP SYN packets sent during the bursts~\cite{device_tracking-5}.

\subsection{Termination Condition}

Phase 1 ends when the attacker has found $T$ attacker 3-tuples, each corresponding to a unique cell of the perturbation table. This ensures that every cell in the table is covered by at least one known attacker 3-tuple~\cite{device_tracking-5}.

\subsection{Importance for Phase 2}

Having a complete set of attacker 3-tuples for all cells of the perturbation table is critical for Phase 2. This is because one cannot directly determine collisions between loopback 3-tuples due to the limited access available on the attacked device. Instead, the attack in Phase 2 relies on the principle that two loopback 3-tuples collide if and only if they both map to the same attacker 3-tuple, as observed by changes in the source port values of TCP SYN packets during the sandwiching method used in Phase 2~\cite{device_tracking-5}.

```

Would you like this more condensed, more detailed, or tailored for a particular LaTeX style (e.g. ACM, IEEE)? Let me know!
