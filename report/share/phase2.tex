%!Tex Root = ../main.tex

\begin{algorithm}{\pr{Finding a Device ID (Phase 2)}}{\thetcbcounter}
	\begin{pseudo}[indent-mark,kw,hl-warn=false]
procedure \cn{Phase2}\\+
$\tt{C} \leftarrow \emptyset; \tt{n} \leftarrow 0; \tt{i} \leftarrow 0$\\
repeat\\+
$\tt{i} \leftarrow \tt{i}+1$\\
$\tt{P} \leftarrow \cn{GetSourcePorts}(\tt{S'})$ \cmt{1st burst}\\
\cn{AttemptConnectTCP}($\{\tt{L}_i\}$)\\
$\tt{P'} \leftarrow \cn{GetSourcePorts}(\tt{S'})$ \cmt{2nd burst}\\
$\tt{w} \leftarrow \text{\iota}(x)(\tt{P'}(x) - \tt{P}(x) > 1)$ \cmt{$|\{\tt{x}\,|\,\tt{P'}(x) - \tt{P}(x) > 1\}| = 1$}\\
if \cn{Defined}($\tt{B}_w$) then \cmt{A collision was found}\\+
$\tt{C} \leftarrow C \cup \{(\tt{L}_i,\tt{B}_w)\}$\\
\cmt{Add the (single) independent pair to C}\\
$\tt{n} \leftarrow n+1$\\-
else\\+
$\tt{B}_w \leftarrow L_i$\\--
until $\tt{n} \ge \tt{n}^*_i$\\
\cmt{This is equiv. to $P^i_D(n) \le p^*$}\\
$\tt{l} \leftarrow \tt{i}$\\
return (\tt{C},\tt{l})\\-
	\end{pseudo}
\end{algorithm}
