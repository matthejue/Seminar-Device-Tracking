%!Tex Root = ../main.tex

\begin{algorithm}{\pr{DHPS Source Port Selection}}{\thetcbcounter}\label{alg:dhps_port_selection}
	\begin{pseudo}[indent-mark,kw,hl-warn=false]
		procedure \cn{SelectEphemeralPort} \\+
		\tt{num\_ephemeral} $\leftarrow \tt{max\_ephemeral} - \tt{min\_ephemeral}+\tn{1}$ \\
    \tt{offset} $\leftarrow$ $\cn{F}_{K_1}$($\tt{IP}_{SRC}$,$\tt{IP}_{DST}$,$\tt{PORT}_{DST}$) \\
    \tt{index} $\leftarrow$ $\cn{G}_{K_2}$($\tt{IP}_{SRC}$,$\tt{IP}_{DST}$,$\tt{PORT}_{DST}$) \\
		\tt{count} $\leftarrow$ \tt{num\_ephemeral} \\
		repeat \\+
		$\tt{port} $\leftarrow$ \tt{min\_ephemeral}$+\\+
		$((\tt{offset}+\tt{table[index]})$ $mod$ $\tt{num\_ephemeral})$ \\-
		$\tt{table[index]} $\leftarrow$ \tt{table[index]} +\tn{1}$ \\
		if \cn{CheckSuitablePort}(\tt{port}) then \\+
		return \tt{port} \\-
		$\tt{count} $\leftarrow$ \tt{count} âˆ’ \tn{1}$ \\-
		until \tt{count} = \tn{0} \\
		return \tt{Error}\\
	\end{pseudo}
\end{algorithm}
