%!Tex Root = ../main.tex

\begin{algorithm}{\pr{DHPS Source Port Selection}}{\thetcbcounter}
	\begin{pseudo}[indent-mark,kw,hl-warn=false]
		procedure \cn{SelectEphemeralPort} \\+
		\tt{num\_ephemeral} $\leftarrow$ \tt{max\_ephemeral}−\tt{min\_ephemeral}+\tn{1} \\
		\tt{offset} $\leftarrow$ \cn{$F_{K_1}$}($IP_{SRC}$,$IP_{DST}$,$PORT_{DST}$) \\
		\tt{index} $\leftarrow$ \cn{$G_{K_2}$}($IP_{SRC}$,$IP_{DST}$,$PORT_{DST}$) \\
		\tt{count} $\leftarrow$ \tt{num\_ephemeral} \\
		repeat \\+
		\tt{port} $\leftarrow$ \tt{min\_ephemeral}+\\+
		((\tt{offset}+\tt{table[index]}) mod \tt{num\_ephemeral}) \\-
		\tt{table[index]} $\leftarrow$ \tt{table[index]} +\tn{1} \\
		if \cn{CheckSuitablePort}(\tt{port}) then \\+
		return \tt{port} \\-
		\tt{count} $\leftarrow$ \tt{count} − \tn{1} \\-
		until \tt{count} = \tn{0} \\
		return \cn{Error}\\
	\end{pseudo}
\end{algorithm}
